<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Downloader</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(to right, #ff7e5f, #feb47b);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }
    h1 {
        margin-top: 50px;
        color: white;
        font-size: 2rem;
    }
    #url-input {
        margin-top: 30px;
        padding: 10px;
        width: 90%;
        max-width: 400px;
        border-radius: 8px;
        border: none;
        font-size: 1rem;
    }
    #fetch-btn {
        margin-top: 10px;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        background-color: #6a82fb;
        color: white;
        font-size: 1rem;
        cursor: pointer;
    }
    #video-info {
        margin-top: 20px;
        width: 90%;
        max-width: 500px;
        color: white;
    }
    .video-card {
        margin-top: 15px;
        padding: 10px;
        background: rgba(255,255,255,0.1);
        border-radius: 8px;
    }
    .download-btn {
        margin: 5px;
        padding: 5px 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        color: white;
    }
</style>
</head>
<body>
<h1>Video Downloader</h1>
<input type="text" id="url-input" placeholder="Enter YouTube URL">
<button id="fetch-btn">Fetch</button>

<div id="video-info"></div>

<script>
const fetchBtn = document.getElementById("fetch-btn");
const urlInput = document.getElementById("url-input");
const videoInfoDiv = document.getElementById("video-info");

fetchBtn.addEventListener("click", async () => {
    const url = urlInput.value.trim();
    if (!url) return alert("Please enter a URL");

    videoInfoDiv.innerHTML = "Loading...";

    try {
        const res = await fetch(`/info?url=${encodeURIComponent(url)}`);
        const data = await res.json();
        renderVideo(data);
    } catch(err) {
        videoInfoDiv.innerHTML = "Error fetching info.";
    }
});

function renderVideo(info) {
    videoInfoDiv.innerHTML = "";
    if (info.entries) {
        // Playlist mode
        info.entries.forEach(video => {
            const card = document.createElement("div");
            card.className = "video-card";
            card.innerHTML = `<strong>${video.title}</strong>`;
            
            ["144p","240p","360p","480p","720p","1080p"].forEach(q => {
                const btn = document.createElement("button");
                btn.className = "download-btn";
                btn.style.backgroundColor = `hsl(${Math.random()*360},70%,50%)`;
                btn.textContent = `MP4 ${q}`;
                btn.onclick = () => window.open(`/download?url=${encodeURIComponent(video.url)}&format=${q}`, "_blank");
                card.appendChild(btn);
            });

            videoInfoDiv.appendChild(card);
        });
    } else {
        // Single video mode
        const card = document.createElement("div");
        card.className = "video-card";
        card.innerHTML = `<strong>${info.title}</strong><br>`;

        ["bestvideo+bestaudio","bestaudio"].forEach(f => {
            const btn = document.createElement("button");
            btn.className = "download-btn";
            btn.style.backgroundColor = `hsl(${Math.random()*360},70%,50%)`;
            btn.textContent = f.includes("audio") ? "MP3" : "MP4";
            btn.onclick = () => window.open(`/download?url=${encodeURIComponent(info.webpage_url)}&format=${f}`, "_blank");
            card.appendChild(btn);
        });

        videoInfoDiv.appendChild(card);
    }
}
</script>
</body>
</html>